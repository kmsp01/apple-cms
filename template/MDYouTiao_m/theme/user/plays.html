<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="full-screen" content="true">
		<meta name="screen-orientation" content="portrait">
		<meta name="x5-fullscreen" content="true">
		<meta name="360-fullscreen" content="true">
		<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1,viewport-fit=cover">
		<title>观看历史 - 会员中心 - {$maccms.site_name}</title>
		<meta name="keywords" content="会员中心,{$maccms.site_keywords}">
		<meta name="description" content="{$maccms.site_description}">
		{include file="system/include"}
		<link rel="stylesheet" type="text/css" href="{$maccms.path}MDassets/h5/css/favs.css">
	</head>
	<body style="font-size: 12px;">
		<div id="app">
			<div class="app-layout app-view">
				<div class="containers router-view" style="padding-top: 40px;">
					<div class="page-header">
						<div class="page-header-top">
							<div class="page-left" onclick="javascript:history.back(-1);"><i class="iconfont iconnext"></i></div>
							<div class="page-center">观看历史</div>
							<div class="page-right"><span class="clearHistory">编辑</span></div>
						</div>
					</div>
					{if condition="$__PAGING__.record_total gt 0"}
					<div class="lists van-list" style="padding-bottom: 1rem;">
						<div class="date-list" id="content">
							{volist name="list" id="vo"}
							{if condition="$vo.ulog_mid eq 1"}
							{maccms:vod num="100000" order="desc" by="time" ids="'.$vo['ulog_rid'].'" id="vo1" key="key1"}
							<div class="van-swipe-cell first-cell video-surface">
								<a href="{$vo.data.link}" class="van-swipe-cell__wrapper">
									<div class="van-cell">
										<div class="van-cell__value van-cell__value--alone">
											<dl>
												<div class="list">
													<label class="check-content" style="display: none;">
														<input type="checkbox" {if condition="$vo.ulog_points eq 0"}name="ids[]" value="{$vo.ulog_id}"{/if}>
														<span class="checkmark"></span>
													</label>
													<div class="img-bg img" style="background-image: url({:mac_url_img($vo1.vod_pic)});">
														<div class="duration">{$vo1.vod_duration|mac_default=''}</div>
													</div>
													<div class="content">
														<h1>{$vo1.vod_name}</h1>
														<div class="div">
															{include file="module/star2"}
															<span>{$vo1.vod_score}</span>
														</div>
														<p>{$vo1.vod_hits}次播放 | {$vo1.vod_up}喜欢</p>
													</div>
												</div>
											</dl>
										</div>
									</div>
								</a>
							</div>
							{/maccms:vod}
							{/if}
							{/volist}
						</div>
						{include file="module/lazy"}
					</div>
					{else/}
					<div class="empty">
						<img src="{$maccms.path}MDassets/h5/img/empty.png">
						<p>您没有观看任何视频哦!</p>
					</div>
					{/if}
					<div class="bottomFixedBar" style="display: none;z-index:10;">
						<p onClick="MAC.CheckBox.All('ids[]');">全选</p>
						<p id="btnDel">删除</p>
					</div>
				</div>
			</div>
			<script>
				$(".clearHistory").click(function() {
					if ($(this).hasClass("open")) {
						$(this).removeClass("open");
						$(".check-content").toggle();
						$(".bottomFixedBar").toggle();
						$(this).html("编辑");
					} else {
						$(this).addClass("open");
						$(".check-content").toggle();
						$(".bottomFixedBar").toggle();
						$(this).html("完成");

					}
				});
		
		
				function delData(ids,all){
					var msg ='删除';
					if(all==1){
						msg='清空';
					}
					layer.confirm('确定要'+msg+'记录吗', {
						title:'提示',btn: ['确定','取消'] //按钮
					}, function(){
						$.post("{:mac_url('user/ulog_del')}",{ids:ids,type:4,all:all},function(data) {
							if (data.code == '1') {
								layer.msg('删除成功');
								setTimeout(function(){
									location.reload();
								},1500);
							}else {
								layer.msg('删除失败：' + data.msg);
							}
						}, 'json')
					});
				}
				$("#btnClear").click(function(){
					delData('',1);
				});
				$("#btnDel").click(function(){
					var ids = MAC.CheckBox.Ids('ids[]');
					if(ids==''){
						layer.msg("请至少选择一个数据");
						return;
					}
					delData(ids,0);
				});
			</script>

		</div>

	</body>
</html>
