<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width,initial-scale=1">
		<title>用户注册 - {$maccms.site_name}</title>
		<meta name="keywords" content="{$maccms.site_keywords}">
		<meta name="description" content="{$maccms.site_description}">
		{include file="system/include"}
		<link rel="stylesheet" type="text/css" href="{$maccms.path}MDassets/web/css/login.css">
	</head>
	<body>
		<div id="appSite" class="site reset-element">
			{include file="system/header"}
			<div class="main-contaner">
				<div class="middle">
					<div class="el-row">
						<div>
							<div class="login findPwd">
								<div class="find-pwd">
									<div class="step_1">
										<h2>注册账号</h2>
										<form method="post" id="fm" action="">
											<div class="row-phone el-row" style="margin-top: 20px;">
												<div class="el-input el-input--prefix">
													<input type="text" id="user_name" name="user_name" autocomplete="off" placeholder="请输入您的登录账号" class="el-input__inner">
													<span class="el-input__prefix">
														<img src="{$maccms.path}MDassets/web/img/username.png" class="input-icon">
													</span>
												</div>
											</div>
											<div class="row-phone el-row" style="margin-top: 20px;">
												<div class="el-input el-input--prefix">
													<input type="password" id="user_pwd" name="user_pwd" autocomplete="off" placeholder="请输入您的登录密码" class="el-input__inner">
													<span class="el-input__prefix">
														<img src="{$maccms.path}MDassets/web/img/password.png" class="input-icon">
													</span>
												</div>
											</div>
											<div class="row-phone el-row" style="margin-top: 20px;">
												<div class="el-input el-input--prefix">
													<input type="password" id="user_pwd2" name="user_pwd2" autocomplete="off" placeholder="请输入您的确认密码" class="el-input__inner">
													<span class="el-input__prefix">
														<img src="{$maccms.path}MDassets/web/img/password.png" class="input-icon">
													</span>
												</div>
											</div>
											{if condition="$user_config.reg_phone_sms neq 0"}
											<input type="hidden" name="ac" value="phone">
											<div class="el-row is-align-center" style="margin-top: 20px;">
												<div class="Verify capacha-input el-input el-input--prefix">
													<input type="text" id="to" name="to" autocomplete="off" placeholder="请输入您的手机号" class="el-input__inner">
													<span class="el-input__prefix"><img src="{$maccms.path}MDassets/web/img/capacha.png" class="input-icon"></span>
												</div>
												<button type="button" id="btn_send_sms" class="el-button capacha-button half-round el-button--default Verify-img">
													<span>获取验证码</span>
												</button>
											</div>
											<div class="row-phone el-row" style="margin-top: 20px;">
												<div class="capacha-input el-input el-input--prefix">
													<input type="text" id="code" name="code" autocomplete="off" placeholder="请输入您的手机验证码" class="el-input__inner">
													<span class="el-input__prefix"><img src="{$maccms.path}MDassets/web/img/capacha.png" class="input-icon"></span>
												</div>
											</div>
											{elseif condition="$user_config.reg_email_sms neq 0"}
											<input type="hidden" name="ac" value="email">
											<div class="el-row is-align-center" style="margin-top: 20px;">
												<div class="Verify capacha-input el-input el-input--prefix">
													<input type="text" id="to" name="to" autocomplete="off" placeholder="请输入您的邮箱地址" class="el-input__inner">
													<span class="el-input__prefix"><img src="{$maccms.path}MDassets/web/img/capacha.png" class="input-icon"></span>
												</div>
												<button type="button" id="btn_send_sms" class="el-button capacha-button half-round el-button--default Verify-img">
													<span>获取验证码</span>
												</button>
											</div>
											<div class="row-phone el-row" style="margin-top: 20px;">
												<div class="capacha-input el-input el-input--prefix">
													<input type="text" id="code" name="code" autocomplete="off" placeholder="请输入您的邮箱验证码" class="el-input__inner">
													<span class="el-input__prefix"><img src="{$maccms.path}MDassets/web/img/capacha.png" class="input-icon"></span>
												</div>
											</div>
											{/if}
											<div class="row-phone el-row" style="margin-top: 20px;">
												<div class="el-input el-input--prefix">
													<input type="text" id="codes" name="codes" autocomplete="off" value="<?php echo $_COOKIE['invite'];?>" placeholder="邀请码（选填，没有可不填）" class="el-input__inner">
													<span class="el-input__prefix"><img src="{$maccms.path}MDassets/web/img/inviteCode.png" class="input-icon"></span>
												</div>
											</div>
											{if condition="$GLOBALS['config']['user']['reg_verify'] eq 1"}
											<div class="row-phone el-row" style="margin-top: 20px;">
												<div class="Verify capacha-input el-input el-input--prefix">
													<input type="text" id="verify" name="verify" autocomplete="off" placeholder="请输入验证码" class="el-input__inner">
													<span class="el-input__prefix"><img src="{$maccms.path}MDassets/web/img/capacha.png" class="input-icon"></span>
												</div>
												<div class="Verify-img">
													<img id="verify_img" src="{:mac_url('verify/index')}" onClick="this.src=this.src+'?'"  alt="单击刷新" />
												</div>		
											</div>	
											{/if}
											<div class="text-center btn-wrap el-row">
												<button type="button" id="btn_submit" class="el-button btn-login el-button--primary is-round">
													<span>立即注册</span>
												</button>
												<div class="btn-tip-wrap">
													<a href="{:mac_url('user/login')}" class="bottom-btn">已有账号？直接登录</a>
												</div>
											</div>
										</form>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				{include file="system/footer"}
				<script type="text/javascript">
					var countdown=60;
					function settime(val) {
						if (countdown == 0) {
							val.removeAttribute("disabled");
							val.value="获取验证码";
							countdown = 60;
							return true;
						} else {
							val.setAttribute("disabled", true);
							val.value="重新发送(" + countdown + ")";
							countdown--;
						}
						setTimeout(function() {settime(val) },1000)
					}
						$("body").bind('keyup',function(event) {
							if(event.keyCode==13){ $('#btnLogin').click(); }
						});

						$('#btn_send_sms').click(function(){
							var ac = $('input[name="ac"]').val();
							var to = $('input[name="to"]').val();
							if(ac=='email') {
								var pattern = /^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
								var ex = pattern.test(to);
								if (!ex) {
									layer.msg('邮箱格式不正确');
									return;
								}
							}
							else if(ac=='phone') {
								var pattern=/^[1][0-9]{10}$/;
								var ex = pattern.test(to);
								if (!ex) {
									layer.msg('手机号格式不正确');
									return;
								}
							}
							else{
								layer.msg('参数错误');
								return;
							}


							settime(this);
							var data = $("#fm").serialize();

							$.ajax({
								url: "{:url('user/reg_msg')}",
								type: "post",
								dataType: "json",
								data: data,
								beforeSend: function () {
									//开启loading
								},
								success: function (r) {
									layer.msg(r.msg);
								},
								complete: function () {
									//结束loading
								}
							});
						});

						$('#btn_submit').click(function() {
							if ($('#user_name').val()  == '') { layer.msg('请输入您的登录账号！'); $("#user_name").focus(); return false; }
							if ($('#user_pwd').val()  == '') { layer.msg('请输入您的登录密码！'); $("#user_pwd").focus(); return false; }
							if ($('#user_pwd2').val()  == '') { layer.msg('请输入您的确认密码！'); $("#user_pwd2").focus(); return false; }
							if ($('#verify').val()  == '') { layer.msg('请输入验证码！'); $("#verify").focus(); return false; }

							$.ajax({
								url: "{:mac_url('user/reg')}",
								type: "post",
								dataType: "json",
								data: $('#fm').serialize(),
								beforeSend: function () {
									$("#btn_submit").val("loading...");
								},
								success: function (r) {
									layer.msg(r.msg);
									if(r.code==1){
										location.href="{:mac_url('user/login')}";
									}
									else{
										$('#verify_img').click();
									}
								},
								complete: function () {
									$("#btn_submit").val("立即注册");
								}
							});

						});
				</script>
			</div>
		</div>
	</body>
</html>
